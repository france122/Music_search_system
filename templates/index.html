<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>歌词检索系统</title>
    <style type="text/css">
        .bg {
            background-image: url("../static/background.jpg");
            background-repeat: no-repeat;
            background-size: 100% 100%;
            background-position: center;
            background-attachment: fixed;
        }

        * {
            box-sizing: border-box;
        }

        em,
        i {
            font-style: normal;
        }

        li {
            list-style: none;
        }

        a {
            text-decoration: none;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            /* 水平分散对齐 */
            align-items: center;
            padding-left: 50px;
            height: 100px;
        }

        .nav ul {
            display: flex;
            align-items: center;
        }

        .nav ul li {
            margin-right: 25px;
        }

        .nav ul li a {
            display: block;
            height: 100px;
            line-height: 100px;
            font-size: 20px;
            color: #050505;
        }

        .nav ul li a:hover {
            border-bottom: 2px solid #ec500b;
            color: #ec500b;
        }

        .login a {
            font-size: 20px;
            color: #050505;
            text-decoration: none;
            margin-right: 40px;
        }

        .login a:hover {
            color: #ec500b;
        }

        .welcome_text {
            margin: 0 auto;
            text-align: center;
        }

        .welcome_text h2 {
            display: inline-block;
        }

        .main-content {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            margin: 20px auto;
            width: 80%;
            transform: translateX(20%);
        }

        .form-container {
            width: 600px;
            text-align: center;
            position: relative;
            right: 5%;
        }

        form {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }

        input {
            height: 45px;
            padding: 0 10px;
            border: 2px solid #ec500b;
            border-radius: 5px;
            flex: 1;
            max-width: 260px;
        }

        select {
            height: 45px;
            border: 2px solid #ec500b;
            border-radius: 5px;
            font-size: 16px;
            padding: 0 10px;
        }

        button {
            height: 45px;
            cursor: pointer;
            background-color: #ec500b;
            color: #ffffff;
            font-size: 20px;
            border: 2px solid #d44907;
            transition: background-color 0.3s;
            padding: 0 20px;
            margin-right: 40px;
            border-radius: 6px;
        }

        button:hover {
            background-color: #d44907;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .add-lyric-button {
            width: 100%;
            background-color: #28a745;
            border: 2px solid #218838;
        }

        .remove-lyric-button {
            width: 100px;
            background-color: #dc3545;
            border: 2px solid #c82333;
        }

        .artist-links {
            margin-top: 20px;
            text-align: center;
        }

        .artist-links a {
            margin: 5px;
            display: inline-block;
            color: #ec500b;
            text-decoration: none;
            font-size: 18px;
        }

        .search-field {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .field-select,
        .input-field,
        .remove-button {
            font-size: 20px;
            margin-right: 10px;
        }

        .remove-button {
            background-color: #ec500b;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 6px;
        }

        .remove-button:hover {
            background-color: #d32f2f;
        }

        .box2 {
            text-align: center;
            background-color: #ffecdf;
            padding: 20px 0;
        }

        .box2 li {
            display: inline-block;
            margin: 0 10px;
        }

        .explain {
            text-align: left;
            margin-left: 100px;
            color: orange;
        }

        .singer {
            display: inline-block;
            text-align: center;
        }

        .singer a {
            color: #000000;
        }

        .singer img {
            height: 160px;
            width: 160px;
        }

        .singer_name {
            margin-top: 10px;
            font-weight: bold;
        }

        .introduction {
            margin-top: 5px;
            color: #666;
        }

        .btm {
            text-align: center;
            padding: 20px 0;
            background-color: #f2f2f2;
        }

        .canvas-container {
            display: flex;
            align-items: flex-start;
            position: relative;
            right: 8%;
        }

        #arousal-valence-canvas {
            width: 250px;
            height: 250px;
            background-image: url("../static/image/va.jpg");
            background-size: cover;
        }

        .tooltip {
            margin-left: 20px;
            border: 1px solid #ccc;
            background-color: white;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 350px;
            display: none; /* 默认隐藏 */
        }
    </style>
</head>

<body class="bg">
    <div class="nav">
        <ul>
            <li><a href="{{ url_for('index1') }}">首页</a></li>
            <li><a href="{{ url_for('self') }}">个人</a></li>
            <li><a href="{{ url_for('compare') }}">测试</a></li>
        </ul>
        <div class="login">
            <a href="{{ url_for('user_login') }}">退出</a>
        </div>
    </div>

    <div class="welcome_text">
        <h2>您好，{{ username }}，欢迎来到歌词检索系统</h2>
        <br />
    </div>

    <div class="main-content">
        <div class="form-container">
            <!-- 综合搜索表单 -->
            <form action="{{ url_for('search') }}" method="post">
                <div id="search-inputs">
                    <div class="search-field">
                        <select name="fields[]" class="field-select" onchange="updateField(this)">
                            <option value="key_all">全部字段</option>
                            <option value="key_word">歌词</option>
                            <option value="key_artist">歌手</option>
                            <option value="key_song">歌名</option>
                            <option value="key_album">专辑</option>
                            <option value="key_version">版本</option>
                        </select>
                        <input type="text" style="font-size: 20px" placeholder="请输入您想要查询的内容" name="key_all">
                    </div>
                </div>
                <div class="form-buttons">
                    <button type="button" onclick="addSearchField()">添加搜索框</button>
                    <button type="submit">搜 索</button>
                    <input type="hidden" id="arousal" name="arousal" value="">
                    <input type="hidden" id="valence" name="valence" value="">
                </div>
            </form>
        </div>

        <div class="canvas-container" id="canvas-container">
            <canvas id="arousal-valence-canvas" width="300" height="300"></canvas>
            <div class="tooltip" id="tooltip">
                <p><strong>情感检索</strong></p>
                <p>可在坐标系内选择您想要查询的歌曲情感</p>
                <p>纵轴表示情感的能量水平，从低唤醒到高唤醒</p>
                <p>横轴表示情感的愉快程度，从负效价到正效价</p>
            </div>
        </div>
    </div>

    <script>
        function addSearchField() {
            const searchInputs = document.getElementById('search-inputs');

            const searchFieldDiv = document.createElement('div');
            searchFieldDiv.className = 'search-field';

            const fieldSelect = document.createElement('select');
            fieldSelect.name = 'fields[]';
            fieldSelect.className = 'field-select';
            fieldSelect.onchange = function () { updateField(this) };

            const options = [
                { value: 'key_all', text: '全部字段' },
                { value: 'key_word', text: '歌词' },
                { value: 'key_artist', text: '歌手' },
                { value: 'key_song', text: '歌名' },
                { value: 'key_album', text: '专辑' },
                { value: 'key_version', text: '版本' }
            ];

            options.forEach(optionData => {
                const option = document.createElement('option');
                option.value = optionData.value;
                option.text = optionData.text;
                fieldSelect.appendChild(option);
            });

            searchFieldDiv.appendChild(fieldSelect);
            addInputField(searchFieldDiv, 'key_all');

            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.textContent = '删除';
            removeButton.className = 'remove-button';
            removeButton.onclick = function () { removeSearchField(this) };

            searchFieldDiv.appendChild(removeButton);
            searchInputs.appendChild(searchFieldDiv);
        }

        function removeSearchField(button) {
            const searchFieldDiv = button.parentNode;
            searchFieldDiv.remove();
        }

        function updateField(selectElement) {
            const searchFieldDiv = selectElement.parentNode;
            const selectedValue = selectElement.value;

            const oldInput = selectElement.nextElementSibling;
            if (oldInput && oldInput.tagName !== 'BUTTON') {
                oldInput.remove();
            }

            addInputField(searchFieldDiv, selectedValue);
        }

        function addInputField(parent, fieldType) {
            let inputField;
            if (fieldType === 'key_version') {
                inputField = document.createElement('select');
                inputField.name = fieldType;
                inputField.className = 'input-field';

                const versionOptions = [
                    { value: '', text: '不限版本' },
                    { value: 'Live', text: 'Live' },
                    { value: 'DJ', text: 'DJ' },
                    { value: '广场舞版', text: '广场舞版' },
                    { value: '普通话版', text: '普通话版' }
                ];

                versionOptions.forEach(optionData => {
                    const option = document.createElement('option');
                    option.value = optionData.value;
                    option.text = optionData.text;
                    inputField.appendChild(option);
                });
            } else {
                inputField = document.createElement('input');
                inputField.type = 'text';
                inputField.className = 'input-field';
                inputField.name = fieldType;

                switch (fieldType) {
                    case 'key_all':
                        inputField.placeholder = '请输入您想要查询的内容';
                        break;
                    case 'key_word':
                        inputField.placeholder = '请输入您想要查询的歌词';
                        break;
                    case 'key_artist':
                        inputField.placeholder = '请输入您想要查询的歌手';
                        break;
                    case 'key_song':
                        inputField.placeholder = '请输入您想要查询的歌名';
                        break;
                    case 'key_album':
                        inputField.placeholder = '请输入您想要查询的专辑';
                        break;
                }
            }

            const removeButton = parent.querySelector('.remove-button');
            parent.insertBefore(inputField, removeButton);
        }

        const canvas = document.getElementById('arousal-valence-canvas');
        const ctx = canvas.getContext('2d');
        let dragging = false;
        let arousal = 0;
        let valence = 0;

        canvas.addEventListener('mousedown', function (e) {
            dragging = true;
            updateArousalValence(e);
        });

        canvas.addEventListener('mousemove', function (e) {
            if (dragging) {
                updateArousalValence(e);
            }
        });

        canvas.addEventListener('mouseup', function () {
            dragging = false;
        });

        canvas.addEventListener('mouseover', function () {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'block';
        });

        canvas.addEventListener('mouseout', function () {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'none';
        });

        function updateArousalValence(e) {
            const rect = canvas.getBoundingClientRect();
            valence = (e.clientX - rect.left) / rect.width * 2 - 1;
            arousal = 1 - (e.clientY - rect.top) / rect.height * 2;
            document.getElementById('arousal').value = arousal.toFixed(2);
            document.getElementById('valence').value = valence.toFixed(2);
            drawPoint(valence, arousal);
        }

        function drawPoint(valence, arousal) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const x = (valence + 1) / 2 * canvas.width;
            const y = (1 - arousal) / 2 * canvas.height;
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, 2 * Math.PI);
            ctx.fillStyle = 'red';
            ctx.fill();
        }
    </script>

    <div class="box2">
        <div class="explain">点击以下主要歌手可浏览其全部歌曲</div>
        <ul>
            <li>
                <div class="singer">
                    <a href="{{ url_for('search', **{'fields[]': 'key_artist', 'key_artist': '周杰伦'}) }}" target="_blank">
                        <img src="../static/image/artist1.jpg" alt="歌手图片">
                        <div class="singer_name">周杰伦</div>
                    </a>
                </div>
            </li>
            <li>
                <div class="singer">
                    <a href="{{ url_for('search', **{'fields[]': 'key_artist', 'key_artist': '凤凰传奇'}) }}" target="_blank">
                        <img src="../static/image/artist2.jpg" alt="歌手图片">
                        <div class="singer_name">凤凰传奇</div>
                    </a>
                </div>
            </li>
            <li>
                <div class="singer">
                    <a href="{{ url_for('search', **{'fields[]': 'key_artist', 'key_artist': '苏打绿'}) }}" target="_blank">
                        <img src="../static/image/artist3.jpg" alt="歌手图片">
                        <div class="singer_name">苏打绿</div>
                    </a>
                </div>
            </li>
            <li>
                <div class="singer">
                    <a href="{{ url_for('search', **{'fields[]': 'key_artist', 'key_artist': '李宇春'}) }}" target="_blank">
                        <img src="../static/image/artist4.jpg" alt="歌手图片">
                        <div class="singer_name">李宇春</div>
                    </a>
                </div>
            </li>
            <li>
                <div class="singer">
                    <a href="{{ url_for('search', **{'fields[]': 'key_artist', 'key_artist': '张学友'}) }}" target="_blank">
                        <img src="../static/image/artist5.jpg" alt="歌手图片">
                        <div class="singer_name">张学友</div>

                    </a>
                </div>
            </li>
            <li>
                <div class="singer">
                    <a href="{{ url_for('search', **{'fields[]': 'key_artist', 'key_artist': '五月天'}) }}" target="_blank">
                        <img src="../static/image/artist6.jpg" alt="歌手图片">
                        <div class="singer_name">五月天</div>

                    </a>
                </div>
            </li>
        </ul>
    </div>

    <footer class="btm">
        @信息存储与检索课程 第三小组
    </footer>


</body>

</html>
